# Система за електронен обмен на съобщения (СЕОС)

## Процедура за генериране и издаване на транспортен сертификат

### версия 1.1-beta1, март 2017

### Съдържание

1. [Съдържание](#съдържание)
2. [Версии](#версии)
3. [Въведение](#въведение)
4. [Попълване на бланка за регистрация за издаване на транспортен сертификат](#попълване-на-бланка-за-регистрация-за-издаване-на-транспортен-сертификат)
5. [Генериране на ключова двойка и заявка за издаване транспортен сертификат с помощта на функциите на OpenSSL](#генериране-на-ключова-двойка-и-заявка-за-издаване-транспортен-сертификат-с-помощта-на-функциите-на-openssl)
6. [Контакт](#контакт)
7. [Приложения](#приложения)
   1. [Приложение 1. Бланка за издаване на транспортен сертификат](#приложение-1-бланка-за-издаване-на-транспортен-сертификат)
   2. [Приложение 2. Примерна бланка за издаване на транспортен сертификат](#приложение-2-примерна-бланка-за-издаване-на-транспортен-сертификат)

### Версии

* 1.1-beta1 (март-април 2017)
  * Първоначална версия.

### Въведение

Настоящият документ описва процедурата по генериране и издаване на транспортен сертификат за целите на електронния обмен на съобщения.

### Попълване на бланка за регистрация за издаване на транспортен сертификат

Попълва се [Приложение 1. Бланка за издаване на транспортен сертификат](#приложение-1-бланка-за-издаване-на-транспортен-сертификат).

За примерни данни може да се използва [Приложение 2. Примерна бланка за издаване на транспортен сертификат](#приложение-2-примерна-бланка-за-издаване-на-транспортен-сертификат).

### Генериране на ключова двойка и заявка за издаване транспортен сертификат с помощта на функциите на OpenSSL

1. Инсталиране на [OpenSSL](https://www.openssl.org/)

   * При Linux-базирани операционни системи, това може да стане, като използвате инструментите за управление на пакетите на съответната
     дистрибуция или от изходен код.

   * При Windows-базирани опрационни системи, това може да стане, като изтеглите и разархивирате последната версия на предварително
     компилирания дистрибутив от [SourceForge](https://sourceforge.net/projects/openssl/).
2. Стартиране на OpenSSL

   * При Linux-базирани операционни системи, след като OpenSSL вече е инсталиран, стартирането става с командата:
     ```bash
     openssl
     ```

   * При Windows-базирани опрационни системи, от директорията "*bin*" на разархивирания дистрибутив се стартира "*openssl.exe*".

   В резултат на това се отваря конзолата за изпълнение на команди на OpenSSL. Подканването в конзолата е с префикса "OpenSSL> ".

3. Генериране на файл, който ще съдържа частния ключ

   Генерирането на RSA двойка публичен/частен ключ се извършва с командатата:

   ```openssl
   genrsa -out file.key 2048
   ```

   , където:

   * *file.key* – наименование на файла съдържащ частния ключ;
   * *2048* - брой битове, от които се състои ключа (препоръчват се поне 2048, по възможност 4096).

   Примерен изход от изпълнението на командата:

   ```txt
   OpenSSL> genrsa -out file.key 2048
   Generating RSA private key, 2048 bit long modulus
   ........................................................................................................................................................................................................................................	.....................................................................................................+++
   ...................+++
   e is 65537 (0x10001)
   ```

4. Генериране на заявка за издаване на сертификат

   Генерирането на заявка за издаване на сертификат на базата на генерирания частен ключ:
   ```openssl
   req -new -key file.key -out file.csr
   ```

   , където:

   * *file.key* – наименование на файла съдържащ частния ключ (генериран от предходната стъпка);
   * *file.csr* – наименование на файла съдържащ заявката за издаване на сертификат.

   По време на изпълнението на командата, последователно се въвеждат данните от попълнената бланка за регистрация за полетата:

   | Поле                                   | Описание                                        | Пример                    |
   | -------------------------------------- | ----------------------------------------------- | ------------------------- |
   | Country Name (2 letter code)           | двубуквен код на държавата на латиница          | BG                        |
   | State or Province Name (full name)     | ЕИК/БУЛСТАТ на организацията префиксиран с "B:" | B:000695025               |
   | Locality Name (eg. city)               | населено място на латиница                      | Sofia                     |
   | Organization Name (eg. company)        | наименование на организацията на латиница       | Administratsiya X         |
   | Organizational Unit Name (eg. section) | наименование на звено                           | Administrative Office     |
   | Common Name (eg. YOUR name)            | наименование на хоста за комуникация[^1]        | administratsiyaX.obmen.bg |
   | Email Address                          | имейл адрес за контакт                          | obmen@administratsiyaX.bg |

   Всички останали полета могат да бъдат оставени празни.

   Примерен изход от изпълнението на командата:

   ```txt
   OpenSSL> req -new -key file.key -out file.csr
   You are about to be asked to enter information that will be incorporated
   into your certificate request.
   What you are about to enter is what is called a Distinguished Name or a DN.
   There are quite a few fields but you can leave some blank
   For some fields there will be a default value,
   If you enter '.', the field will be left blank.
   -----
   Country Name (2 letter code) [AU]:BG
   State or Province Name (full name) [Some-State]:B:000695025
   Locality Name (eg, city) []:Sofia
   Organization Name (eg, company) [Internet Widgits Pty Ltd]:Administratsiya X
   Organizational Unit Name (eg, section) []:Administrative Office
   Common Name (e.g. server FQDN or YOUR name) []:administratsiyaX.obmen.bg
   Email Address []:obmen@administratsiyaX.bg

   Please enter the following 'extra' attributes
   to be sent with your certificate request
   A challenge password []:
   An optional company name []:
   ```

5. Изпращане на заявката за издаване на сертификат

   Попълнената бланка от предходната глава заедно с генерираната в т.3 заявка за издаване насертификатУЕП (файла "*file.csr*") се изпращат
   по електронната поща на адрес [support@mail.stampit.org](mailto:support@mail.stampit.org).

6. Издаване на транспортен сертификат

   Доставчикът на удостоверителни услуги проверява дали данните от попълнената бланка и генерираната заявка съвпадат.

   * Ако данните не съвпадат, дотавчикът има право да откаже издаване на транспортен сертификат.
   * Ако данните съвпадат, доставчикът издава транспортен сертификат и го изпраща по електронна поща обратно на администратора

7. Експортиране на сертификата във формат за инсталиране

   Доставчикът на удостоверителни услуги изпраща транспортния сертификат под формата на
   [X.509 сертификат](https://en.wikipedia.org/wiki/X.509) във файл с разширение "*.cer*".

   За да може да бъде инсталиран, сертификатът трябва да бъде обединен с частния ключ от т.1 в
   [PKCS#12 хранилище](https://en.wikipedia.org/wiki/PKCS_12) във файл с разширение "*.p12*".

   Това може да стане с командата:

   ```openssl
   pkcs12 -export -in file.cer -out file.p12 -inkey file.key
   ```

   , където:

   * *file.cer* – наименование на файла съдържащ издадения в т.5 транспортен сертификат, получен от доставчика на удостоверителни услуги;
   * *file.p12* – наименование на файла съдържащ транспортния сертификат и неговия частен ключ, готови за инсталиране;
   * *file.key* – наименование на файла съдържащ частния ключ генериран в т.2.

   По време на изпълнението на командата се въвежда парола за защита на генерирания "*.p12*" файл.

   Примерен изход от изпълнението на командата:

   ```txt
   OpenSSL> pkcs12 -export -in file.cer -out file.p12 -inkey file.key
   Enter Export Password:
   Verifying - Enter Export Password:
   ```

### Контакт

За допълнителни въпроси и коментари:

* Елин Колев
* Тел: [+359 2 965 6229](tel:+35929656229), [+359 88 900 0449](tel:+359889000449)
* Имейл: [e.kolev@is-bg.net](mailto:e.kolev@is-bg.net)

### Приложения

#### Приложение 1. Бланка за издаване на транспортен сертификат

| Наименование                                     | Данни включени в съдържанието на удостоверението |
| ------------------------------------------------ | ------------------------------------------------ |
| Канонично име на сървър/**Common Name**[^2]      |                                                  |
| Наименование на организация/**Organization**[^3] |                                                  |
| ЕИК/Булстат/**State of Province**[^4]            |                                                  |
| Име на град/**Locality**                         |                                                  |
| Име на държавата/**Country**                     |                                                  |
| Дата                                             |                                                  |

Вж. приложения файл [registration_edoc_blank.xls](Процедура%20по%20вписване%20на%20участник/blank_registration_edoc.xls).

#### Приложение 2. Примерна бланка за издаване на транспортен сертификат

| Наименование                                     | Данни включени в съдържанието на удостоверението |
| ------------------------------------------------ | ------------------------------------------------ |
| Канонично име на сървър/**Common Name**[^2]      | administratsiyaX.obmen.bg                        |
| Наименование на организация/**Organization**[^3] | Administratsiya X                                |
| ЕИК/Булстат/**State of Province**[^4]            | 000695025                                        |
| Име на град/**Locality**                         | Sofia                                            |
| Име на държавата/**Country**                     | BG                                               |
| Дата                                             | 31.03.2017                                       |

Вж. приложения файл [registration_edoc_example.xls](Процедура%20по%20вписване%20на%20участник/blank_registration_edoc.xls).

---

[^1]: Наименованието на хоста трябва да съответства на частта с наименованието на хоста, на който ще бъде публикувана уеб услугата за
комуникация. Например, ако услугата ще бъде публикувана на адрес
[https://administratsiyaX.obmen.bg:8443/](https://administratsiyaX.obmen.bg:8443/), то наименованието на хоста следва да бъде
"*administratsiyaX.obmen.bg*".
[^2]: Вписва се точният адрес на системата.
[^3]: Възможно е изписване по два начина: а) Транслитерация според Закона за транслитерацията или б) Английски език
[^4]: Изписва се (9 или 13 цифрен) ЕИК/БУЛСТАТ на съответната организацията.
