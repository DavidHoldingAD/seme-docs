# Система за електронен обмен на съобщения (СЕОС)

## Процедура по проверка за съвместимост

### версия 1.1-beta1, март-април 2017

### Държавна агенция "Електронно управление"

### Съдържание

1. [Съдържание](#съдържание)
2. [Версии](#версии)
3. [Въведение](#въведение)
4. [Тестови сценарии](#тестови-сценарии)
    * [Проверка на извличането на Регистъра на участниците](#проверка-на-извличането-на-регистъра-на-участниците)
    * [Проверка на изпращането на съобщение на участник](#проверка-на-изпращането-на-съобщение-на-участник)
    * [Проверка на получаването на съобщение от участник](#проверка-на-получаването-на-съобщение-от-участник)

### Версии

* 1.1-beta1 (март-април 2017)
  * Първоначална версия

### Въведение

Настоящият документ описва тестовите сценарии и процедурата по проверка на съвместимостта на системата на участник с електронния обмен на
съобщения.

Проверката за съвместимост се извършва за потвърждаване на готовността на софтуерните решения да обменят съобщения в СЕОС:

* в тестова среда – от производителите на софтуер за обмен на съобщения;
* в продукционна среда – от внедрителите на софтуер за обмен на съобщения.

Тестове в продукционна среда **трябва** да бъдат извършвани **единствено** с тестов участник, освен ако с отсрещната страна изрично не е
уговорено друго.

### Тестови сценарии

При осъществяване на връзка между участници в обмена или между участник и Регистъра на участниците, връзката е от тип
[клиент-сървър](https://bg.wikipedia.org/wiki/%D0%9A%D0%BB%D0%B8%D0%B5%D0%BD%D1%82-%D1%81%D1%8A%D1%80%D0%B2%D1%8A%D1%80). За да бъде
избегнато двусмислие, в описанието на тестовите сценарии ще бъде използвана следната терминология:

* **Клиент** – при осъществяване на TCP/IP връзка, това е страната, която инициира връзката.
* **Клиентски сертификат** – при осъществяване на HTTPS връзка, това е сертификатът използван от **клиента**.
* **Сървър** – при осъществяване на TCP/IP връзка, това е страната, която приема връзката.
* **Сървърен сертификат** – при осъществяване на HTTPS връзка, това е сертификатът използван от **сървъра**.
* **Подател** – при обмен на съобщения, това е участникът, който е вписан като подател в заглавната част на съобщението.
* **Получател** – при обмен на съобщения, това е участникът, който е вписан като получател в заглавната част на съобщението.
* **Транспортен сертификат** – това е сертификатът на участник описан в Регистъра на участниците.

#### Проверка на извличането на Регистъра на участниците

...

#### Проверка на изпращането на съобщение на участник

...

##### Проверки на транспортни ниво при изпращане на съобщение на участник

За потвърждаване на правилна обработка на изпращаните съобщения, всеки участник трябва да изпълнява описаните по-долу тестови сценарии.

*Забележка:* В тестовите сценарии за изпращане на съобщение, тестваната страна действа като **клиент**, а тестващата – като **сървър**.

1. (И.7) **Клиентът връща грешка, когато сървърният сертификат не съответства на транспортния сертификат на получателя**

    *Сценарий:* Сървърът използва сървърен сертификат, който не съответства на асоциирания в Регистъра с получателя на съобщението.

    *Очакван резултат:* Сървърът връща **Изключение/грешка (*fault*)**, като прекратява по-нататъшна обработка.

* Изпращане на съобщение от различен вид:
  * "Заявление за регистриране на документ"
    * Документ без файлове в електронния архив
    * Документ с файлове в електронния архив
  * "Заявление за проверка на състоянието на документ"
  * "Известие за състоянието на документ"
  * "Известие за грешка"

##### Проверки на приложно ниво при изпращане на съобщение на участник

Проверки на съдържанието на съобщенията (**приложно ниво**):

* Обработка на резултат при всеки вид изпратено съобщение:
  * Обработка на изключение/грешка
  * Обработка на празно съобщение-отговор
  * Обработка на съобщение-отговор от различен вид:
    * *Обработката трябва да бъде същата като при получаване*, като следните съобщения трябва да се третират като грешка:
      * **(!)** "Заявление за регистриране на документ"
      * **(!)** "Заявление за проверка на състоянието на документ"
...

#### Проверка на получаването на съобщение от участник

...

##### Проверки на транспортно ниво при получаване на съобщение от участник

За потвърждаване на правилна обработка на получаваните съобщения, всеки участник трябва да изпълнява описаните по-долу тестови сценарии.

*Забележка:* В тестовите сценарии за получаване на съобщение, тестваната страна действа като **сървър**, а тестващата – като **клиент**.

1. (П.1) **Сървърът връща грешка, когато клиентът не предоставя клиентски сертификат.**

    *Сценарий:* Клиентът не използва клиентски сертификат за установяване на HTTPS връзка с получателя.

    *Очакван резултат:* Сървърът връща **Изключение/грешка (*fault*)**, като прекратява по-нататъшна обработка.

2. (?) **Сървърът връща грешка, когато клиентът използва невалиден клиентски сертификат.**

    *Сценарий:* Клиентът използва невалиден клиентски сертификат (вж. [RFC 5280](https://tools.ietf.org/html/rfc5280)).

    *Очакван резултат:* Сървърът връща **Изключение/грешка (*fault*)**, като прекратява по-нататъшна обработка.

3. (П.5 ?) **Сървърът връща грешка, когато клиентът използва клиентският сертификат, който не принадлежи на вписан участник.**

    *Сценарий:* Клиентът използва клиентски сертификат, който не принадлежи на участник вписан в Регистъра на участниците.

    *Очакван резултат:* Сървърът връща **Изключение/грешка (*fault*)**, като прекратява по-нататъшна обработка.

4. (П.5 ?) **Сървърът връща грешка, когато клиентът използва клиентски сертификат на неактивен участник.**

    *Сценарий:* Клиентът използва клиентски сертификат, съответстващият участник на който е със статус "*Неактивен*" в Регистъра на
    участниците.

    *Очакван резултат:* Сървърът връща **Изключение/грешка (*fault*)**, като прекратява по-нататъшна обработка.

5. (?) **Сървърът връща грешка, когато размерът полученото съобщение надхвърля максимално допустимия размер.**

    *Сценарий:* Клиентът изпраща съобщение, размерът на което надхвърля установения максимално допустим размер.

    *Очакван резултат:* Сървърът връща **Изключение/грешка (*fault*)**, като прекратява по-нататъшна обработка.

6. (П.2) **Сървърът връща грешка, когато полученото съобщение не е валиден XML документ.**

    *Сценарий:* Клиентът изпраща съобщение, което не представля валиден XML документ.

    *Очакван резултат:* Сървърът връща **Изключение/грешка (*fault*)**, като прекратява по-нататъшна обработка.

7. (П.3) **Сървърът връща грешка, когато полученото съобщение е XML документ, който не съответства на XSD схемите за обмен на съобщения.**

    *Сценарий:* Клиентът изпраща съобщение, което представля валиден XML документ, който не съответства на XSD схемите описващи обмена
    на съобщения.

    *Очакван резултат:* Сървърът връща **Изключение/грешка (*fault*)**, като прекратява по-нататъшна обработка.

8. (П.4) **Сървърът връща грешка, когато получателят на съобщението е друг участник.**

    *Сценарий:* Клиентът изпраща съобщение, получателят на което е различен участника обслужван от настоящата крайна точка.

    *Очакван резултат:* Сървърът връща **Изключение/грешка (*fault*)**, като прекратява по-нататъшна обработка.

9. (П.6) **Сървърът връща грешка, когато транспортният сертификат на подателя не съвпада с използвания транспортен сертификат.**

    *Сценарий:* Клиентът изпраща съобщение, подателят на което е описан в Регистъра на участниците с транспортен сертификат различен от
    използвания клиентски сертификат.

    *Очакван резултат:* Сървърът връща **Изключение/грешка (*fault*)**, като прекратява по-нататъшна обработка.

10. (П.7) **Сървърът връща грешка, когато полученото съобщение не е електронно подписано.**

    *Сценарий:* Клиентът изпраща съобщение, което не е електронно подписано.

    *Очакван резултат:* Сървърът връща **Изключение/грешка (*fault*)**, като прекратява по-нататъшна обработка.

11. (П.8) **Сървърът връща грешка, когато полученото съобщение е подписано електронен сертификат различен от транспортния сертификат.**

    *Сценарий:* Клиентът изпраща съобщение, което е електронно подписано със сертификат различен от транспортния сертификат на подателя
    описан в Регистъра на участниците.

    *Очакван резултат:* Сървърът връща **Изключение/грешка (*fault*)**, като прекратява по-нататъшна обработка.

12. (П.9) **Сървърът връща грешка, когато съобщението вече е получено.**

    *Сценарий:* Клиентът изпраща съобщение, GUID (глобялният уникален идентификатор) на което съвпада с GUID на вече получено съобщение.

    *Очакван резултат:* Сървърът връща **Изключение/грешка (*fault*)**, като прекратява по-нататъшна обработка.

13. (?) **Сървърът връща отговор, когато изпращането преминава всички проверки.**

    *Сценарий:* Клиентът изпраща съобщение, което преминава всички проверки.

    *Очакван резултат:* Сървърът връща съобщение-отговор (или празен отговор).

##### Проверки на приложно ниво при получаване на съобщение от участник

Проверки на съдържанието на съобщенията (**приложно ниво**):

* Получаване на съобщения от различен вид:
    * *Броят на проверките за всеки един вид съобщение варира* според възможността на системата да (не) връща съобщение-отговор.
    * "Заявление за регистриране на документ"
      * ...
    * "Заявление за проверка на състоянието на документ"
      * Заявлението касае липсващ документ
      * Заявлението касае документ с различен статус:
        * "Документът очаква регистрация"
        * "Документът е регистриран"
        * "Работата по документа е прекратена"
        * "Работата по документа е приключена"
        * "Документът не е открит"
        * "Документът вече е получен"
        * "Регистрацията на документа е отказана"
    * "Известие за състояние на документ"
      * Известието касае несъществуващ документ
      * Известието за документа с различен статус:
        * "Документът очаква регистрация"
        * "Документът е регистриран"
        * "Работата по документа е прекратена"
        * "Работата по документа е приключена"
        * "Документът не е открит"
        * "Документът вече е получен"
        * "Регистрацията на документа е отказана"
    * "Известие за грешка"
      * Известието касае несъществуващо съобщение
      * Грешка от различен тип:
        * "Вътрешна грешка"
        * "Външна грешка"
...
